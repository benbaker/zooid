block content
  #graphVisualization(style="width:100%;height:100%;")


  script(type="text/javascript" src="/js/vivagraph.js")
  script.
      (function (io) {

      var socket = io.connect();

      function forceGraph() {
         
          graph = Viva.Graph.graph();

          var graphics = Viva.Graph.View.svgGraphics(),
              nodeSize = 28;

          graphics.node(function(node) {

            nodeSize = node.size || nodeSize
            console.log(node.data || node.id)

            var ui      = Viva.Graph.svg('g'),
                title   =  ( node.data || node.id ),
                svgText = Viva.Graph.svg('text')
                  .attr('y', '-1px')
                  .text(title),

                img     = Viva.Graph.svg('image')
                           .attr('width', nodeSize)
                           .attr('height', nodeSize)
                           .link('/files/' + node.data);

            //- if(node.data) ui.append(svgText);
            if( node.data ) 
              if( node.data.split('.').pop() === "jpg"  ) 
                ui.append(img);
              else
                ui.append(svgText);

            return ui;
          }).placeNode(function(nodeUI, pos) {
              // 'g' element doesn't have convenient (x,y) attributes, instead
              // we have to deal with transforms: http://www.w3.org/TR/SVG/coords.html#SVGGlobalTransformAttribute
              nodeUI.attr('transform',
                          'translate(' +
                                (pos.x - nodeSize/2) + ',' + (pos.y - nodeSize/2) +
                          ')');
          });




          var layout = Viva.Graph.Layout.forceDirected(graph, {
              springLength : 18,
              springCoeff : 0.0001,
              dragCoeff : 0.06,
              gravity : -1.9
          });

          var renderer = Viva.Graph.View.renderer( graph, {
              graphics : graphics
            , container : document.getElementById('graphVisualization')

          });


          renderer.run();

          return graph
      }


      graph = forceGraph()



      $(document).ready(function(){


       /**
         * Listens for model changes over socket.
         * @param  {String} model   Model name
         * @return null
         */
      
        socket.on( "zode", function(dataset){
            signalModel.emit(dataset.verb, dataset);
        })

        /**
         * Gets some amount of the signals from the model
         * for display now, and bsubscribe to them.
         * Intended to be customized, kinda.
         * @param  {String}   model name
         * @return null
         */
        
        socket.get( "/zode/find", { limit:50 }, function(zodes){

          $.map(zodes, function(zode){

            graph.addNode( ""+zode.name, ""+zode.id)
            graph.addNode( ""+zode.name, ""+zode.ip)
            graph.addLink( ""+zode.name, ""+zode.ip)



          })

        })


      })


      })(window.io);
page